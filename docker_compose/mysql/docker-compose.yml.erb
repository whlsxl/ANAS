version: "3.5"

services:
  mysql:
    container_name: ${CONTAINER_PREFIX}mysql
    image: linuxserver/mariadb:10.11.4
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      - "${DATA_PATH}/mysql:/config"
    networks:
      - mysql

  mysql_adminer:
    image: adminer
    container_name: ${CONTAINER_PREFIX}mysql_adminer
    restart: unless-stopped
    env_file:
      - .env
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.adminer.entrypoints=https"
      - "traefik.http.routers.adminer.rule=Host(`${MYSQL_ADMINER_DOMAIN}`)"
      - "traefik.http.routers.adminer.tls=true"
      - "traefik.http.services.adminer.loadbalancer.server.port=8080"
    networks:
      - mysql
      <% if envs['MYSQL_ADMINER_ENABLED'] == 'true' %>
      - traefik
      <% end %>

networks:
  mysql:
    driver: bridge
    name: mysql
<% if envs['MYSQL_ADMINER_ENABLED'] == 'true' %>
  traefik:
    name: traefik
    external: true
<% end %>
